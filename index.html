<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matriz de Competencias Shu-Ha-Ri - Product Owners</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f6fa;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background-color: #00008F;
            padding: 20px;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .header-decoration {
            position: absolute;
            top: -20px;
            right: -20px;
            width: 200px;
            height: 200px;
            background: #FF1721;
            transform: rotate(45deg);
            opacity: 0.3;
        }
        
        .header h1 {
            position: relative;
            z-index: 1;
        }
        
        .header p {
            margin: 5px 0 0 0;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .tabs {
            background-color: white;
            border-bottom: 2px solid #E6E9FF;
            display: flex;
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 25px;
            border: none;
            background-color: transparent;
            color: #2c3e50;
            cursor: pointer;
            font-size: 14px;
            font-weight: normal;
            border-bottom: none;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab.active {
            background-color: #00008F;
            color: white;
            font-weight: bold;
            border-bottom: 3px solid #FF1721;
        }
        
        .content {
            padding: 20px;
        }
        
        .card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .card h3 {
            margin-top: 0;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
        }
        
        .competencia-section {
            margin-bottom: 25px;
        }
        
        .competencia-title {
            color: #00008F;
            margin-bottom: 10px;
            border-bottom: 2px solid #FF1721;
            padding-bottom: 5px;
        }
        
        .comentario {
            margin-bottom: 10px;
            padding-left: 15px;
            border-left: 3px solid #ecf0f1;
        }
        
        .comentario-text {
            margin: 5px 0;
            color: #34495e;
        }
        
        .comentario-autor {
            margin: 5px 0;
            font-size: 12px;
            color: #7f8c8d;
            font-style: italic;
        }
        
        .comentario-general {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #FF1721;
        }
        
        .comentario-general-text {
            margin: 0 0 8px 0;
            color: #2c3e50;
            line-height: 1.6;
        }
        
        .comentario-general-autor {
            margin: 0;
            font-size: 13px;
            color: #7f8c8d;
            font-style: italic;
            text-align: right;
        }
        
        .footer {
            padding: 20px;
            text-align: center;
            color: #7f8c8d;
            font-size: 12px;
        }
        
        .leyenda {
            margin: 5px 0;
        }
        
        .leyenda-item {
            display: inline;
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-decoration"></div>
            <h1>Matriz de Competencias Shu-Ha-Ri</h1>
            <p>Dashboard de Evaluación 360° - Product Owners</p>
        </div>
        
        <div class="tabs" id="tabs"></div>
        
        <div class="content" id="content"></div>
        
        <div class="footer">
            <p>Evaluación basada en el sistema Shu-Ha-Ri</p>
            <p class="leyenda">
                <span class="leyenda-item"><span style="color: #6C757D;">■</span> SHU (Maestro Alto)</span> |
                <span class="leyenda-item"><span style="color: #FF1721;">■</span> HA (Practicante Medio)</span> |
                <span class="leyenda-item"><span style="color: #00008F;">■</span> RI (Aprendiz Bajo)</span>
            </p>
        </div>
    </div>

    <script>
        const rawData = `1;08/10/2025 16:28;08/10/2025 16:35;anonymous;;Aura María Lara;SHU (Maestro) Alto;;HA (Practicante) Medio;;HA (Practicante) Medio;;SHU (Maestro) Alto;;HA (Practicante) Medio;;"Considero que Aura es muy hábil conceptualizando las necesidades funcionales y al tener conocimiento de diferentes procesos logra establecer entregables de valor. 
Admiro la capacidad de manejar tantos frentes a la vez y tenerlo todo controlado, por lo que pienso que es Shu (Maestro) en la planeación y organización. 
Si bien no considero tiene desarrollada la comunicación y liderazgo tal vez ahí hay oportunidades de mejora para plantear su punto de vista más ""fuerte y defenderlo"" y dar mensajes más contundentes. ";M.C
2;08/10/2025 16:35;08/10/2025 16:38;anonymous;;Maria Zarate;SHU (Maestro) Alto;;HA (Practicante) Medio;;HA (Practicante) Medio;;HA (Practicante) Medio;;No Tengo Suficiente Información;;Creo que Pau es muy pila y tiene la habilidad de conceptualizar en entregables de valor las necesidades del negocio, creo que es muy organizada y que tiene habilidades destacables para hacer PPTs vendedoras. No tengo tanto contacto con ella en el día a día, pero en algunos escenarios he visto que puede mejorar la comunicación para llevar mensajes más puntuales y que tengan un objetivo;M.C
3;09/10/2025 8:07;09/10/2025 9:14;anonymous;;Laura Cabieles;HA (Practicante) Medio;considero que Lau tiene una capacidad de conceptualizar las necesidades desde el punto de vista estratégico, si bien en su Rol no es necesario que haga conceptualización para propuestas de procesos o soluciones, sí se interesa por entender y cuestionar las soluciones planteadas;SHU (Maestro) Alto;Creo que la habilidad estratégica de Lau para organizar al equipo y ponernos foco para trabajar en lo más importante y presentarlo estratégicamente ante V.P ha hecho que la percepción de nuestro trabajo y los resultados sea muy bueno;HA (Practicante) Medio;Lau es puntual y clara en los mensajes estratégicos que quiere transmitir. ;HA (Practicante) Medio;Si bien Lau no organiza el plan de trabajo de cada entregable, sí organiza la asignación de nuestros entregables y el seguimiento realizado nos permite tener visual recurrente de los avances y de las alertas;HA (Practicante) Medio;;;`;

        const competencias = [
            { nombre: 'Conceptualización', idxCalif: 6, idxFeedback: 7 },
            { nombre: 'Balance Estratégico', idxCalif: 8, idxFeedback: 9 },
            { nombre: 'Comunicación y Liderazgo', idxCalif: 10, idxFeedback: 11 },
            { nombre: 'Organización', idxCalif: 12, idxFeedback: 13 },
            { nombre: 'Priorización', idxCalif: 14, idxFeedback: 15 }
        ];

        function parseCSV(csv) {
            const lines = csv.split('\n').filter(line => line.trim().match(/^\d+;/));
            const data = [];
            
            for (let line of lines) {
                const values = line.split(';');
                if (values.length >= 16) {
                    data.push(values);
                }
            }
            return data;
        }

        const parsedData = parseCSV(rawData);
        const personasData = {};
        
        parsedData.forEach(values => {
            const persona = (values[5] || '').trim();
            const evaluador = (values[17] || '').trim() || 'Anónimo';
            
            if (!persona) return;
            
            if (!personasData[persona]) {
                personasData[persona] = {
                    evaluaciones: {},
                    comentariosGenerales: []
                };
                
                competencias.forEach(comp => {
                    personasData[persona].evaluaciones[comp.nombre] = {
                        calificaciones: [],
                        comentarios: []
                    };
                });
            }
            
            competencias.forEach(comp => {
                const calif = (values[comp.idxCalif] || '').trim();
                const feedback = (values[comp.idxFeedback] || '').trim();
                
                if (calif) {
                    personasData[persona].evaluaciones[comp.nombre].calificaciones.push(calif);
                }
                
                if (feedback) {
                    personasData[persona].evaluaciones[comp.nombre].comentarios.push({
                        texto: feedback,
                        evaluador: evaluador
                    });
                }
            });
            
            const comentarioGeneral = (values[16] || '').trim();
            if (comentarioGeneral) {
                personasData[persona].comentariosGenerales.push({
                    texto: comentarioGeneral,
                    evaluador: evaluador
                });
            }
        });

        const personas = Object.keys(personasData);
        let currentChart = null;

        function calcularPorcentajes(calificaciones) {
            const validas = calificaciones.filter(c => !c.includes('No Tengo'));
            
            if (validas.length === 0) {
                return { SHU: 0, HA: 0, RI: 0, total: 0 };
            }
            
            const counts = {
                SHU: validas.filter(c => c.includes('SHU')).length,
                HA: validas.filter(c => c.includes('HA')).length,
                RI: validas.filter(c => c.includes('RI')).length
            };
            
            const total = validas.length;
            
            return {
                SHU: Math.round((counts.SHU / total) * 100),
                HA: Math.round((counts.HA / total) * 100),
                RI: Math.round((counts.RI / total) * 100),
                total: total
            };
        }

        function renderConsolidado() {
            const consolidado = competencias.map(comp => {
                let totalSHU = 0, totalHA = 0, totalRI = 0, totalEval = 0;
                
                personas.forEach(persona => {
                    const evaluacion = personasData[persona].evaluaciones[comp.nombre];
                    const validas = evaluacion.calificaciones.filter(c => !c.includes('No Tengo'));
                    
                    totalSHU += validas.filter(c => c.includes('SHU')).length;
                    totalHA += validas.filter(c => c.includes('HA')).length;
                    totalRI += validas.filter(c => c.includes('RI')).length;
                    totalEval += validas.length;
                });
                
                return {
                    competencia: comp.nombre,
                    SHU: totalEval > 0 ? Math.round((totalSHU / totalEval) * 100) : 0,
                    HA: totalEval > 0 ? Math.round((totalHA / totalEval) * 100) : 0,
                    RI: totalEval > 0 ? Math.round((totalRI / totalEval) * 100) : 0,
                    total: totalEval
                };
            });

            const content = document.getElementById('content');
            content.innerHTML = `
                <h2 style="margin-bottom: 20px; color: #00008F;">Consolidado del Equipo</h2>
                <div class="card">
                    <h3>Distribución General de Calificaciones Shu-Ha-Ri</h3>
                    <div class="chart-container">
                        <canvas id="chartCanvas"></canvas>
                    </div>
                </div>
            `;

            if (currentChart) {
                currentChart.destroy();
            }

            const ctx = document.getElementById('chartCanvas').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: consolidado.map(d => d.competencia),
                    datasets: [
                        {
                            label: 'SHU (Maestro)',
                            data: consolidado.map(d => d.SHU),
                            backgroundColor: '#6C757D',
                            stack: 'stack0'
                        },
                        {
                            label: 'HA (Practicante)',
                            data: consolidado.map(d => d.HA),
                            backgroundColor: '#FF1721',
                            stack: 'stack0'
                        },
                        {
                            label: 'RI (Aprendiz)',
                            data: consolidado.map(d => d.RI),
                            backgroundColor: '#00008F',
                            stack: 'stack0'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const index = context.dataIndex;
                                    return 'Total evaluaciones: ' + consolidado[index].total;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: '% de Evaluaciones'
                            }
                        }
                    }
                }
            });
        }

        function renderPersona(persona) {
            const graficaData = [];
            
            competencias.forEach(comp => {
                const evaluacion = personasData[persona].evaluaciones[comp.nombre];
                const porcentajes = calcularPorcentajes(evaluacion.calificaciones);
                
                graficaData.push({
                    competencia: comp.nombre,
                    SHU: porcentajes.SHU,
                    HA: porcentajes.HA,
                    RI: porcentajes.RI,
                    total: porcentajes.total
                });
            });

            let competenciasHTML = '';
            competencias.forEach(comp => {
                const comentarios = personasData[persona].evaluaciones[comp.nombre].comentarios;
                if (comentarios.length === 0) return;
                
                let comentariosHTML = '';
                comentarios.forEach(comentario => {
                    comentariosHTML += `
                        <div class="comentario">
                            <p class="comentario-text">"${comentario.texto}"</p>
                            <p class="comentario-autor">— ${comentario.evaluador}</p>
                        </div>
                    `;
                });
                
                competenciasHTML += `
                    <div class="competencia-section">
                        <h4 class="competencia-title">${comp.nombre}</h4>
                        ${comentariosHTML}
                    </div>
                `;
            });

            let comentariosGeneralesHTML = '';
            personasData[persona].comentariosGenerales.forEach(comentario => {
                comentariosGeneralesHTML += `
                    <div class="comentario-general">
                        <p class="comentario-general-text">${comentario.texto}</p>
                        <p class="comentario-general-autor">— ${comentario.evaluador}</p>
                    </div>
                `;
            });

            const content = document.getElementById('content');
            content.innerHTML = `
                <h2 style="margin-bottom: 20px; color: #00008F;">${persona}</h2>
                
                <div class="card">
                    <h3>Distribución de Calificaciones Shu-Ha-Ri</h3>
                    <div class="chart-container">
                        <canvas id="chartCanvas"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3>Comentarios por Competencia</h3>
                    ${competenciasHTML}
                </div>

                <div class="card">
                    <h3>Comentarios Generales</h3>
                    ${comentariosGeneralesHTML}
                </div>
            `;

            if (currentChart) {
                currentChart.destroy();
            }

            const ctx = document.getElementById('chartCanvas').getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: graficaData.map(d => d.competencia),
                    datasets: [
                        {
                            label: 'SHU (Maestro)',
                            data: graficaData.map(d => d.SHU),
                            backgroundColor: '#6C757D',
                            stack: 'stack0'
                        },
                        {
                            label: 'HA (Practicante)',
                            data: graficaData.map(d => d.HA),
                            backgroundColor: '#FF1721',
                            stack: 'stack0'
                        },
                        {
                            label: 'RI (Aprendiz)',
                            data: graficaData.map(d => d.RI),
                            backgroundColor: '#00008F',
                            stack: 'stack0'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const index = context.dataIndex;
                                    return 'Total evaluaciones: ' + graficaData[index].total;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: '% de Evaluaciones'
                            }
                        }
                    }
                }
            });
        }

        function renderTabs() {
            const tabsContainer = document.getElementById('tabs');
            let tabsHTML = `
                <button class="tab active" onclick="selectTab(-1)">📊 Consolidado del Equipo</button>
            `;
            
            personas.forEach((persona, idx) => {
                tabsHTML += `
                    <button class="tab" onclick="selectTab(${idx})">${persona}</button>
                `;
            });
            
            tabsContainer.innerHTML = tabsHTML;
        }

        function selectTab(index) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach((tab, idx) => {
                if (idx === index + 1) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });

            if (index === -1) {
                renderConsolidado();
            } else {
                renderPersona(personas[index]);
            }
        }

        window.selectTab = selectTab;

        renderTabs();
        renderConsolidado();
    </script>
</body>
</html>
